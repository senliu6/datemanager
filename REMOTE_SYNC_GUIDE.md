# 数据管理平台 - 远程同步功能使用指南

## 概述

远程同步功能支持通过 SSH/SFTP/Rsync/Rclone 等协议将平台中的文件同步到远程服务器，特别适合处理大文件传输，避免浏览器下载限制。

## 支持的同步方式

### 1. SFTP (SSH File Transfer Protocol)
- **适用场景**: 通用文件传输，支持进度显示
- **优点**: 稳定可靠，支持断点续传
- **配置要求**: SSH服务器，用户名/密码或私钥

### 2. Rsync
- **适用场景**: 增量同步，大量文件传输
- **优点**: 只传输变化的部分，效率高
- **配置要求**: 目标服务器安装rsync，SSH访问权限

### 3. Rclone
- **适用场景**: 云存储同步（支持100+云服务商）
- **优点**: 支持各种云存储服务
- **配置要求**: 预先配置rclone远程连接

## 使用步骤

### 第一步：配置连接

1. 进入"远程同步"页面
2. 选择同步方式（SFTP/Rsync/Rclone）
3. 填写连接配置：
   - **主机地址**: 目标服务器IP或域名
   - **端口**: SSH端口（默认22）
   - **用户名**: 服务器用户名
   - **密码**: 用户密码（可选，如使用私钥）
   - **私钥文件**: SSH私钥路径（可选）
   - **远程路径**: 目标目录路径

4. 点击"测试连接"验证配置

### 第二步：选择文件

1. 切换到"文件选择"标签页
2. 勾选要同步的文件
3. 查看选中文件的总大小

### 第三步：执行同步

1. 切换到"执行同步"标签页
2. 确认同步配置信息
3. 选择执行方式：
   - **直接同步**: 在平台上执行同步
   - **生成脚本**: 下载同步脚本，在本地执行

## 配置示例

### SFTP配置示例
```json
{
  "host": "192.168.1.100",
  "port": 22,
  "username": "datauser",
  "password": "your_password",
  "basePath": "/data/uploads"
}
```

### Rsync配置示例
```json
{
  "host": "192.168.1.100",
  "port": 22,
  "username": "datauser",
  "basePath": "/data/uploads",
  "excludePatterns": ["*.tmp", "*.log"]
}
```

### Rclone配置示例
```json
{
  "remote": "mycloud",
  "basePath": "/uploads"
}
```

## 生成的同步脚本

### Rsync脚本示例
```bash
#!/bin/bash

# 自动生成的同步脚本
HOST="192.168.1.100"
USER="datauser"
PORT="22"
REMOTE_PATH="/data/uploads"

echo "同步: large_file.zip"
rsync -avz -e "ssh -p $PORT" "/app/Uploads/large_file.zip" "$USER@$HOST:$REMOTE_PATH/large_file.zip"
if [ $? -eq 0 ]; then
    echo "✅ large_file.zip 同步成功"
else
    echo "❌ large_file.zip 同步失败"
fi
```

### 使用生成的脚本
1. 下载脚本文件
2. 给脚本添加执行权限：`chmod +x sync_script.sh`
3. 执行脚本：`./sync_script.sh`

## 最佳实践

### 1. 大文件传输建议
- **优先使用Rsync**: 支持断点续传，网络中断后可继续
- **分批同步**: 避免一次性同步过多文件
- **网络稳定**: 确保网络连接稳定

### 2. 安全建议
- **使用SSH密钥**: 比密码更安全
- **限制用户权限**: 创建专用同步用户
- **定期更换密钥**: 提高安全性

### 3. 性能优化
- **并发控制**: 避免同时运行多个同步任务
- **带宽限制**: 在生产环境中限制同步带宽
- **监控日志**: 定期检查同步日志

## 故障排除

### 常见问题

#### 1. 连接测试失败
- 检查网络连通性：`ping target_host`
- 验证SSH服务：`ssh user@host -p port`
- 确认防火墙设置

#### 2. 权限错误
- 检查目标目录权限
- 确认用户有写入权限
- 验证SSH密钥权限（600）

#### 3. 同步中断
- 使用Rsync重新同步（自动跳过已传输文件）
- 检查磁盘空间
- 查看网络状态

#### 4. 文件不存在
- 确认源文件路径正确
- 检查文件是否被移动或删除
- 验证数据库记录一致性

### 日志查看
- 服务器日志：`/var/log/auth.log`（SSH连接）
- 应用日志：查看平台审计日志
- Rsync日志：使用`--log-file`参数

## 高级功能

### 1. 自动化同步
可以结合cron定时任务实现自动同步：
```bash
# 每天凌晨2点执行同步
0 2 * * * /path/to/sync_script.sh >> /var/log/sync.log 2>&1
```

### 2. 监控和告警
- 集成监控系统监控同步状态
- 设置同步失败告警
- 定期检查同步完整性

### 3. 多目标同步
- 同时同步到多个服务器
- 实现数据备份冗余
- 负载均衡分发

## 技术支持

如果遇到问题，请：
1. 查看平台审计日志
2. 检查服务器连接状态
3. 验证配置参数
4. 联系系统管理员

---

**注意**: 远程同步功能需要目标服务器的相应权限和网络访问能力。请确保在安全的网络环境中使用。